<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
	<title>地图测试</title>
	<!--<script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>-->
	<!--<link rel="stylesheet" href="maptest.css">-->

</head>
<body>
<div id="mapContainer" class="mapContainer"></div>
<div id="tip" class="tip"></div>
<div id="panel" class="panel">
	<div class="line"></div>
	<div>
		<span class="place">上海基督教景灵堂</span>
		<span>离我最近</span>
	</div>
	<div>
		<span>1208米</span>
		<span>·</span>
		<span>上海市虹口区昆山路1320号(近咋普路)</span>
	</div>
	<div class="btn-wrap">
		<div class="btn" id="btn">
			<a class="btn-font">到这里</a>
		</div>
	</div>
	<a href="http://api.map.baidu.com/direction?origin=latlng:34.264642646862,108.95108518068|name:我家&destination=大雁塔&mode=driving&region=西安&output=html&src=yourCompanyName|yourAppName">驾车导航</a>
</div>

</body>
<script type="text/javascript"
		src="https://webapi.amap.com/maps?v=1.3&key=1825ddd44e06e689e70965bd50c53c29&plugin=AMap.Geocoder"></script>
<script type="text/javascript">
    var geolocation;
    var start_xy = new AMap.LngLat(121.488176, 31.242473);
    var end_xy = new AMap.LngLat(121.526603, 31.231631);
    var map = new AMap.Map('mapContainer', {
//        center: [117.000923, 36.675807],
//        zoom: 6,
        resizeEnable: true
    });
    map.plugin(['AMap.ToolBar', 'AMap.Geolocation'], function () {
        map.addControl(new AMap.ToolBar());
        geolocation = new AMap.Geolocation({
            enableHighAccuracy: true,//是否使用高精度定位，默认:true
            timeout: 10000,          //超过10秒后停止定位，默认：无穷大
            maximumAge: 0,           //定位结果缓存0毫秒，默认：0
            convert: true,           //自动偏移坐标，偏移后的坐标为高德坐标，默认：true
            showButton: true,        //显示定位按钮，默认：true
            buttonPosition: 'LB',    //定位按钮停靠位置，默认：'LB'，左下角
            buttonOffset: new AMap.Pixel(10, 20),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
            showMarker: true,        //定位成功后在定位到的位置显示点标记，默认：true
            showCircle: true,        //定位成功后用圆圈表示定位精度范围，默认：true
            panToLocation: true,     //定位成功后将定位到的位置作为地图中心点，默认：true
            zoomToAccuracy: true      //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
        });
        map.addControl(geolocation);
        geolocation.getCurrentPosition();
        AMap.event.addListener(geolocation, 'complete', onComplete);//返回定位信息
        AMap.event.addListener(geolocation, 'error', onError);
    });
    //解析定位结果
    function onComplete(data) {
        console.info(data);
        var str = ['定位成功'];
        str.push('经度：' + data.position.getLng());
        str.push('纬度：' + data.position.getLat());
        str.push('纬度：' + data.formattedAddress);
        if (data.accuracy) {
            str.push('精度：' + data.accuracy + ' 米');
        }//如为IP精确定位结果则没有精度信息
        str.push('是否经过偏移：' + (data.isConverted ? '是' : '否'));
        document.getElementById('tip').innerHTML = str.join('<br>');
    }
    //解析定位错误信息
    function onError(data) {
        console.info(data);
        document.getElementById('tip').innerHTML = '定位失败';
    }

	/*
	 * 调用驾车服务
	 */
    //加载驾车插件
    //            AMap.plugin(["AMap.Driving"], function () {
    //                var drivingOptions = {
    //                    map: map,
    //                    city: '上海市',
    //                    panel: 'panel',                            //公交城市
    //                    //cityd:'乌鲁木齐',
    //                };
    //                var driving = new AMap.Driving(drivingOptions);
    //                driving.setPolicy(AMap.DrivingPolicy.LEAST_TIME);
    //                driving.search([
    //                    {keyword: '八佰伴',city:'上海'},
    //                    {keyword: '南京路步行街',city:'上海'}
    //                ]);
    //                AMap.event.addListener(driving, 'complete', function (result) {
    //                    console.info(result);
    //                    var steps;
    //                    if (result.info.toLocaleLowerCase() == 'ok') {
    //                        for (var v = 0; v < result.routes.length; v++) {
    //                            steps = result.routes[v].steps;
    //                            console.info('话费总时间：' + result.routes[v].time + 's');
    //                        }
    //                        drawLine(steps, map);
    //                    }
    //                })
    //            });

	/*
	 * 调用骑行服务
	 */
    //    AMap.plugin(['AMap.Riding'], function () {//回调函数
    //        var walkingOptions = {
    //            map: map,
    //            city: '上海市',
    //            panel: 'panel',
    //            hideMarkers: true,
    //            isOutline: false,
    //            outlineColor: 'red'//公交城市
    //        };
    //        //实例化Walking
    //        var riding = new AMap.Riding(walkingOptions);
    //
    //        //传经纬度
    ////        riding.search(start_xy, end_xy);
    //        riding.search([
    //            {keyword: '浦东新区福沈小区', city: '上海'},
    //            {keyword: '饿了么总部', city: '上海'}
    //        ]);
    //        AMap.event.addListener(riding, 'complete', function (result) {
    //            console.info(result);
    //            var steps;
    //            if (result.info.toLocaleLowerCase() == 'ok') {
    //                for (var v = 0; v < result.routes.length; v++) {
    //                    steps = result.routes[v].rides;
    //                    console.info('话费总时间：' + result.routes[v].time + 's');
    //                }
    ////                drawLine(steps, map);
    //            }
    //        })
    //
    //    });


	/*调用步行服务*/
    AMap.plugin(['AMap.Walking'], function () {//回调函数
        var startTime = new Date().getTime();
        var walkingOptions = {
            map: map,
            city: '上海市',
            panel: 'panel',
            hideMarkers: true,
            isOutline: false,
            outlineColor: 'red'//公交城市
        };
        //实例化Walking
        var walking = new AMap.Walking(walkingOptions);

        //        //传经纬度
        walking.search([{keyword:'南京路步行街',city:'上海'}, {keyword:'八佰伴',city:'上海'}]);
        //传经纬度
//                walking.search(start_xy, end_xy);
        AMap.event.addListener(walking, 'complete', function (result) {
            var endTime = new Date().getTime();
            console.info(endTime-startTime);
            console.info(result);
            var steps;
            if (result.info == 'ok') {
                for (var v = 0; v < result.routes.length; v++) {
                    steps = result.routes[v].steps;
                    console.info('话费总时间：' + result.routes[v].time + 's');
                }
                drawLine(steps, map);
            }
        })


    });

    //路线的地图起点终点自定义图标
    function addMarker(position) {
        var mk = new AMap.Marker({
            map: map,
            position: position,
            icon: new AMap.Icon({
                image: 'https://vdata.amap.com/icons/b18/1/2.png',
                size: new AMap.Size(34, 34),
                imageOffset: new AMap.Pixel(4, 0)
            }),
            offset: {
                x: 3,
                y: -16
            }
        });
    }

    function drawLine(data, map) {
        // 起点 终点的坐标
//        var sicon = new AMap.Icon({
//            image: 'https://vdata.amap.com/icons/b18/1/2.png',
//            size: new AMap.Size(34, 34),
//            imageOffset: new AMap.Pixel(4, 0)
//        });
//
//        var startMarker = new AMap.Marker({
//            map: map,
//            position: start_xy,
//            icon: sicon,
//            offset: {
//                x: -10,
//                y: -14
//            }
//        });

//        var eicon = new AMap.Icon({
//            image: 'https://vdata.amap.com/icons/b18/1/2.png',
//            size: new AMap.Size(34, 34),
//            imageOffset: new AMap.Pixel(4, 0)
//        });
//
//        var startMarker = new AMap.Marker({
//            map: map,
//            position: end_xy,
//            icon: eicon,
//            offset: {
//                x: -10,
//                y: -14
//            }
//        });

        //起点到路线的起点 路线的终点到终点 绘制无道路
        var extra_line1 = new Array();
        extra_line1.push(start_xy);
        extra_line1.push(data[0].path[0]);
        var polyline1 = new AMap.Polyline({
            map: map,
            path: extra_line1,
            strokeColor: '#067cff',
            strokeOpacity: 0.9,
            strokeWeight: 4,
            strokeStyle: "dashed",   //虚线
            strokeDasharray: [10, 5],
            zIndex: 9999
        });

        var extra_line2 = new Array();
        var path_xy = data[(data.length - 1)].path;
        extra_line2.push(path_xy[path_xy.length - 1]);
        extra_line2.push(end_xy);
        var polyline2 = new AMap.Polyline({
            map: map,
            path: extra_line2,
            strokeColor: '#067cff',
            strokeOpacity: 0.9,
            strokeWeight: 4,
            strokeStyle: "dashed",   //虚线
            strokeDasharray: [10, 5],
            zIndex: 9999
        });

        for (var s = 0, lens = data.length; s < lens; s++) {
            var drawpath = data[s].path;
            console.info(s + '.---------' + data[s].instruction);
            var polyline3 = new AMap.Polyline({
                map: map,
                path: drawpath,
                strokeColor: '#067cff',
                strokeOpacity: 0.9,
                strokeWeight: 4,
                strokeStyle: "solid",   //虚线
                strokeDasharray: [10, 5],
                zIndex: 9999
            });
        }
        map.setFitView();
    }

    var provinces = [{
        "name": "上海市",
        "center": "121.488170, 31.241453",
        "type": 0,
        "subDistricts": []
    }];

    var icon = new AMap.Icon({
        image: 'https://vdata.amap.com/icons/b18/1/2.png',
        size: new AMap.Size(24, 24)
    });

    marker = new AMap.Marker({
        icon: icon,
        position: end_xy,
        offset: new AMap.Pixel(-12, -12),
        zIndex: 101,
        title: provinces[0].name,
        map: map
    });
    var geocoder = new AMap.Geocoder({
        city: "021", //城市，默认：“全国”
        radius: 1000 //范围，默认：500
    });
    //地理编码,返回地理编码结果
    geocoder.getLocation("上海市浦东新区陆家嘴街道梅园四街坊", function (status, result) {
        if (status === 'complete' && result.info === 'OK') {
            console.info(result);
        }
    });

</script>
</html>